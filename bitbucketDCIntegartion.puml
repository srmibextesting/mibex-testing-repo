@startuml
!define RECTANGLE class

title Connect to Bitbucket Data Center from Confluence Cloud

package "REQUIREMENTS" {
  RECTANGLE "Public DNS entry and IP" as Req1
  RECTANGLE "HTTPS with valid certificate" as Req2
  RECTANGLE "Firewall allows public internet traffic" as Req3
  RECTANGLE "The firewall has to allow traffic from the public internet. Or you can choose to use a static IP, so you can white list the IPs in the firewall as Req4
  RECTANGLE "Optional: Use Static IPs" as Req5
}

package "Bitbucket Data Center Configuration" {
  RECTANGLE "Log into Bitbucket" as BDC1
  RECTANGLE "Navigate to Manage Account" as BDC2
  RECTANGLE "Create HTTP access token" as BDC3
  RECTANGLE "Copy the token" as BDC4
}

package "Confluence Cloud Configuration" {
  RECTANGLE "Navigate to Confluence Configuration" as CC1
  RECTANGLE "Add Bitbucket DC instance" as CC2
  RECTANGLE "Enter Bitbucket URL and token" as CC3
  RECTANGLE "Optional: Use Static IP option" as CC4
}

Req1 --> BDC1 : "Needed for public accessibility"
Req2 --> BDC1 : "Ensures secure communication"
Req3 --> BDC1 : "Allows necessary traffic"
Req4 --> CC4 : "Allows you to white list the IPs in the firewall."

BDC1 --> BDC2 : "User action"
BDC2 --> BDC3 : "User action"
BDC3 --> BDC4 : "User action"

BDC4 --> CC1 : "Provide token to Confluence"
CC1 --> CC2 : "Configuration step"
CC2 --> CC3 : "Configuration step"
CC3 --> CC4 : "Optional configuration"
@enduml
